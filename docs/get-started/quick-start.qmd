---
title: "Quick Start Guide"
subtitle: "Get started with SPI and SPEI calculations in 5 minutes!"
---

## Setup Python Path

Before using the package, add the `src` folder to your Python path:

```python
import sys
sys.path.insert(0, 'src')  # Or use absolute path
```

## Basic Usage

### Calculate SPI

Calculate the Standard Precipitation Index (SPI) for your precipitation data:

```python
import sys
sys.path.insert(0, 'src')

import xarray as xr
from indices import spi, save_index_to_netcdf

# Load your precipitation data
ds = xr.open_dataset('your_precip_data.nc')
precip = ds['precip']  # or 'precipitation', 'prcp', 'pr'

# Calculate SPI-12 (12-month scale)
spi_12 = spi(
    precip,
    scale=12,
    periodicity='monthly',
    calibration_start_year=1991,
    calibration_end_year=2020
)

# Save results
save_index_to_netcdf(spi_12, 'spi_12_output.nc')
```

### Calculate SPEI

Calculate the Standardized Precipitation Evapotranspiration Index (SPEI):

```python
from indices import spei

# Load precipitation and temperature
precip = ds['precip']
temp = ds['temperature']
lat = ds['lat']

# Calculate SPEI-12 (auto-calculates PET from temperature)
spei_12 = spei(
    precip,
    temperature=temp,
    latitude=lat,
    scale=12,
    periodicity='monthly',
    calibration_start_year=1991,
    calibration_end_year=2020
)

# With Pearson III distribution (recommended for SPEI)
spei_12_p3 = spei(
    precip,
    temperature=temp,
    latitude=lat,
    scale=12,
    distribution='pearson3'
)

save_index_to_netcdf(spei_12_p3, 'spei_pearson3_12_output.nc')
```

::: {.callout-tip}
## Temperature-based PET

The `spei()` function automatically calculates PET using the Thornthwaite method when you provide temperature data. This is convenient for most applications.

If you have pre-computed PET values, use `pet=your_pet_data` instead of `temperature=`.
:::

::: {.callout-tip}
## Distribution Selection

By default, all functions use the **Gamma** distribution. You can choose from five supported distributions via the `distribution` parameter:

- `'gamma'` ‚Äî Default, standard for SPI (McKee et al. 1993)
- `'pearson3'` ‚Äî Recommended for SPEI (Vicente-Serrano et al. 2010)
- `'log_logistic'` ‚Äî Alternative for SPEI (original R SPEI package)
- `'gev'` ‚Äî For extreme value analysis
- `'gen_logistic'` ‚Äî European drought indices

See the [Probability Distributions](../technical/distributions.qmd) page for detailed guidance.
:::

### Multi-Scale Calculation

Calculate multiple time scales at once for efficiency:

```python
from indices import spi_multi_scale

# Calculate SPI for multiple time scales at once
spi_multi = spi_multi_scale(
    precip,
    scales=[1, 3, 6, 12],
    periodicity='monthly',
    calibration_start_year=1991,
    calibration_end_year=2020
)

# Access individual scales
spi_1 = spi_multi['spi_gamma_1_month']
spi_3 = spi_multi['spi_gamma_3_month']
spi_12 = spi_multi['spi_gamma_12_month']
```

::: {.callout-note}
## Performance Tip

Multi-scale calculation is more efficient than calculating each scale separately, especially for large datasets.
:::

### Save and Reuse Parameters

Speed up repeated calculations by saving and reusing fitted distribution parameters:

```python
from indices import save_fitting_params, load_fitting_params

# Calculate SPI and save parameters
spi_12, params = spi(precip, scale=12, return_params=True)

# Save parameters for future use
save_fitting_params(
    params,
    'spi_params.nc',
    scale=12,
    periodicity='monthly',
    index_type='spi'
)

# Later: Load and reuse parameters (much faster!)
params = load_fitting_params('spi_params.nc', scale=12, periodicity='monthly')
spi_12_fast = spi(new_precip, scale=12, fitting_params=params)
```

### Customizing Output Metadata

By default, output NetCDF files include minimal metadata (source, CF conventions). You can customize the metadata attributes in two ways:

::: {.panel-tabset}
#### Set Defaults Once

Modify `DEFAULT_METADATA` at the start of your script. All subsequent outputs will use these values:

```python
from config import DEFAULT_METADATA

# Set your organization's metadata
DEFAULT_METADATA['institution'] = 'My University, Department of Geography'
DEFAULT_METADATA['source'] = 'precip-index package v2026.1'
DEFAULT_METADATA['references'] = 'McKee et al. (1993)'
DEFAULT_METADATA['comment'] = 'Drought monitoring project'

# All subsequent outputs will include these attributes
spi_12 = spi(precip, scale=12)
```

#### Override Per Function Call

Pass `global_attrs` to override metadata for specific outputs:

```python
spi_ds = spi_multi_scale(
    precip,
    scales=[3, 12],
    global_attrs={
        'institution': 'ACME Research Lab',
        'project': 'Regional Drought Monitor',
    }
)

# Also works with save_fitting_params, spi_global, spei_global, etc.
save_fitting_params(
    params, 'spi_params.nc',
    scale=12, periodicity='monthly', index_type='spi',
    global_attrs={'institution': 'My Organization'}
)
```
:::

::: {.callout-tip}
## Available Metadata Fields

The default metadata fields are: `institution`, `source`, `Conventions`, `references`, and `comment`. You can also add any custom fields via `global_attrs` (e.g., `project`, `contact`, `license`).
:::

## Climate Extremes Event Analysis

Identify and analyze complete extreme events using run theory:

::: {.panel-tabset}
### Drought Events

```python
from runtheory import identify_events
from visualization import plot_events

# Identify drought events (negative threshold)
spi_location = spi_12.isel(lat=50, lon=100)
drought_events = identify_events(spi_location, threshold=-1.2, min_duration=3)

print(f"Found {len(drought_events)} drought events")
print(drought_events[['start_date', 'end_date', 'duration', 'magnitude', 'peak']])

# Visualize events
plot_events(spi_location, drought_events, threshold=-1.2)
```

### Wet Events

```python
# Identify wet events (positive threshold) - same function!
wet_events = identify_events(spi_location, threshold=+1.2, min_duration=3)

print(f"Found {len(wet_events)} wet events")
plot_events(spi_location, wet_events, threshold=+1.2)
```

### Gridded Statistics

```python
from runtheory import calculate_period_statistics

# Calculate gridded statistics for a time period
stats = calculate_period_statistics(
    spi_12,
    threshold=-1.2,
    start_year=2020,
    end_year=2024
)

# Plot number of events per grid cell
stats.num_events.plot(title='Number of Drought Events 2020-2024')
```
:::

::: {.callout-important}
## Bidirectional Analysis

The same functions work for both drought (negative threshold) and wet events (positive threshold). This unified approach makes analysis consistent and straightforward.
:::

## Data Requirements

### Format

- **File Type:** NetCDF files (.nc)
- **Dimensions:** Any order is supported (auto-transposes to CF Convention)
  - Preferred: `(time, lat, lon)`
  - Also works: `(lat, lon, time)` ‚Üê Auto-detected and transposed!
- **Temporal Resolution:** Monthly or daily

### Variables

**For SPI:**

- Precipitation in mm/month or mm/day

**For SPEI:**

- Precipitation in mm/month or mm/day
- Temperature in ¬∞C (for PET calculation)
- OR pre-computed PET in mm/month or mm/day

### Calibration Period

- **Default:** 1991-2020 (WMO recommendation)
- **Minimum:** 30 years for robust statistics
- **Requirement:** Should overlap with your data period

## Understanding the Output

### SPI/SPEI Classification

| Value Range | Category | Probability | Interpretation |
|-------------|----------|-------------|----------------|
| ‚â§ -2.00 | Exceptionally Dry | Bottom 2.3% | Exceptional drought |
| -2.00 to -1.50 | Extremely Dry | Bottom 6.7% | Severe drought |
| -1.50 to -1.20 | Severely Dry | Bottom 9.7% | Severe drought |
| -1.20 to -0.70 | Moderately Dry | Bottom 24.2% | Moderate drought |
| -0.70 to -0.50 | Abnormally Dry | Bottom 30.9% | Below normal |
| -0.50 to +0.50 | Near Normal | Middle 38.2% | Normal conditions |
| +0.50 to +0.70 | Abnormally Moist | Top 30.9% | Above normal |
| +0.70 to +1.20 | Moderately Moist | Top 24.2% | Moderately wet |
| +1.20 to +1.50 | Very Moist | Top 9.7% | Very wet conditions |
| +1.50 to +2.00 | Extremely Moist | Top 6.7% | Extremely wet conditions |
| ‚â• +2.00 | Exceptionally Moist | Top 2.3% | Extreme flooding risk |

### Time Scales

| Scale | Application | Use Case |
|-------|-------------|----------|
| 1-month | Meteorological | Short-term precipitation deficits |
| 3-month | Agricultural | Seasonal crop stress |
| 6-month | Agricultural/Hydrological | Medium-term water resources |
| 12-month | Hydrological | Long-term water supply |
| 24-month | Socio-economic | Multi-year water planning |

## Common Issues

::: {.callout-warning}
### Issue: "ModuleNotFoundError: No module named 'indices'"

**Solution:** Make sure to add the src directory to Python path:

```python
import sys
sys.path.insert(0, 'src')
```
:::

::: {.callout-warning}
### Issue: All NaN output

**Possible causes:**

- Calibration period doesn't overlap with data
- All zero or negative precipitation values
- Check: `precip.min()`, `precip.max()`, data year range
:::

::: {.callout-warning}
### Issue: "ValueError: cannot reshape array"

**Solution:** This was a bug in earlier versions, now fixed! The code automatically handles any dimension order.
:::

## Run the Test Script

Test with the included example data:

```bash
python tests/run_all_tests.py
```

This will:

1. Load TerraClimate Bali data from `input/` folder
2. Calculate SPI-3 and multi-scale SPI
3. Calculate SPEI with temperature
4. Test run theory functions
5. Display statistics and validation

Expected runtime: ~30 seconds

## Learn More

::: {.grid-container}
::: {.feature-card}
### üìì Jupyter Notebooks

Interactive tutorials with real data

[View Tutorials](../tutorials/01-calculate-spi.qmd)
:::

::: {.feature-card}
### üìñ User Guide

Detailed methodology and usage

[Read Guide](../user-guide/index.qmd)
:::

::: {.feature-card}
### üîß API Reference

Complete function documentation

[API Docs](../technical/api-reference.qmd)
:::
:::

## Next Steps

Now that you know the basics:

1. **Try the tutorials** - Work through interactive examples with real climate data
2. **Read the methodology** - Understand SPI, SPEI, and run theory
3. **Explore visualizations** - Create publication-quality plots
4. **Use your own data** - Apply the package to your research

## Support

Need help?

1. Check the [Tutorials](../tutorials/01-calculate-spi.qmd) for step-by-step examples
2. Review the [User Guide](../user-guide/index.qmd) for detailed explanations
3. See [test results](../../tests/README.md) for validation examples
4. Open an issue on [GitHub](https://github.com/bennyistanto/precip-index/issues)

---

**Ready to dive deeper? Try the [SPI Tutorial](../tutorials/01-calculate-spi.qmd) next!**
